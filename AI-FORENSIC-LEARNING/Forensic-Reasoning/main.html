<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forensic Reasoning Training System</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîç</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-cyan: #00f0ff;
            --primary-blue: #0066ff;
            --dark-bg: #0a0e27;
            --darker-bg: #060913;
            --card-bg: rgba(15, 23, 42, 0.8);
            --border-color: rgba(0, 240, 255, 0.2);
            --text-primary: #e8eef7;
            --text-secondary: #94a3b8;
            --warning-color: #fbbf24;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --glass-bg: rgba(15, 23, 42, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--dark-bg);
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(0, 102, 255, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 240, 255, 0.08) 0%, transparent 50%),
                linear-gradient(180deg, #0a0e27 0%, #060913 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 240, 255, 0.03) 2px,
                    rgba(0, 240, 255, 0.03) 4px
                );
            pointer-events: none;
            z-index: 1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
            position: relative;
            z-index: 2;
        }

        header {
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-cyan), transparent);
            animation: scan 3s linear infinite;
        }

        @keyframes scan {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        h1 {
            color: var(--primary-cyan);
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
            text-shadow: 0 0 30px rgba(0, 240, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.9em;
            font-weight: 400;
            font-family: 'JetBrains Mono', monospace;
            letter-spacing: 0.5px;
            opacity: 0.8;
        }

        .warning-banner {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(251, 191, 36, 0.05) 100%);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-left: 4px solid var(--warning-color);
            padding: 18px 20px;
            margin-bottom: 24px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .warning-banner strong {
            color: var(--warning-color);
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
        }

        .connection-status {
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .status-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            position: relative;
            animation: pulse-ring 2s ease-out infinite;
        }

        .status-indicator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: pulse-dot 2s ease-out infinite;
        }

        .status-connected {
            background: var(--success-color);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }

        .status-connected::before {
            background: var(--success-color);
        }

        .status-disconnected {
            background: var(--danger-color);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }

        .status-disconnected::before {
            background: var(--danger-color);
        }

        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 currentColor; }
            100% { box-shadow: 0 0 0 8px transparent; }
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.5; transform: translate(-50%, -50%) scale(1.3); }
        }

        .status-text-group {
            flex: 1;
        }

        .status-text-group p {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .module-card {
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .module-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.05), transparent);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .module-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary-cyan);
            box-shadow: 
                0 8px 32px rgba(0, 240, 255, 0.2),
                0 0 0 1px rgba(0, 240, 255, 0.1) inset;
        }

        .module-card:hover::before {
            opacity: 1;
        }

        .module-card.active {
            border-color: var(--primary-cyan);
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.1), var(--glass-bg));
            box-shadow: 
                0 8px 32px rgba(0, 240, 255, 0.3),
                0 0 0 1px var(--primary-cyan) inset;
        }

        .module-icon {
            font-size: 2.5em;
            margin-bottom: 12px;
            display: block;
            filter: drop-shadow(0 4px 8px rgba(0, 240, 255, 0.3));
        }

        .module-title {
            color: var(--primary-cyan);
            font-size: 1.15em;
            font-weight: 600;
            margin-bottom: 8px;
            letter-spacing: -0.3px;
        }

        .module-desc {
            color: var(--text-secondary);
            font-size: 0.9em;
            line-height: 1.5;
        }

        .workspace {
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 32px;
            min-height: 500px;
            display: none;
            backdrop-filter: blur(20px);
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .workspace.active {
            display: block;
        }

        .workspace h2 {
            color: var(--primary-cyan);
            font-size: 1.8em;
            font-weight: 600;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .input-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            color: var(--primary-cyan);
            margin-bottom: 10px;
            font-weight: 500;
            font-size: 0.95em;
            letter-spacing: 0.3px;
        }

        textarea, input[type="text"] {
            width: 100%;
            background: rgba(10, 14, 39, 0.6);
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 12px;
            padding: 16px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95em;
            transition: all 0.3s ease;
            line-height: 1.6;
        }

        textarea {
            min-height: 180px;
            resize: vertical;
        }

        textarea:focus, input:focus {
            outline: none;
            border-color: var(--primary-cyan);
            box-shadow: 
                0 0 0 3px rgba(0, 240, 255, 0.1),
                0 0 20px rgba(0, 240, 255, 0.2);
            background: rgba(10, 14, 39, 0.8);
        }

        textarea::placeholder, input::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
        }

        button {
            background: linear-gradient(135deg, var(--primary-cyan) 0%, var(--primary-blue) 100%);
            color: var(--darker-bg);
            border: none;
            padding: 12px 28px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            font-size: 0.95em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-right: 12px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 240, 255, 0.3);
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(0, 240, 255, 0.4);
        }

        button:hover::before {
            left: 100%;
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        button:disabled:hover {
            box-shadow: 0 4px 16px rgba(0, 240, 255, 0.3);
        }

        .output-area {
            background: rgba(6, 9, 19, 0.6);
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
            max-height: 600px;
            overflow-y: auto;
        }

        .output-area::-webkit-scrollbar {
            width: 8px;
        }

        .output-area::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .output-area::-webkit-scrollbar-thumb {
            background: rgba(0, 240, 255, 0.3);
            border-radius: 4px;
        }

        .output-area::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 240, 255, 0.5);
        }

        .timeline-item {
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.05), transparent);
            border-left: 3px solid var(--primary-cyan);
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 8px;
        }

        .timeline-time {
            color: var(--primary-cyan);
            font-weight: 600;
            margin-bottom: 6px;
            font-family: 'JetBrains Mono', monospace;
        }

        .uncertainty {
            color: var(--warning-color);
            font-style: italic;
            font-size: 0.9em;
            padding: 12px;
            background: rgba(251, 191, 36, 0.05);
            border-radius: 8px;
            border-left: 3px solid var(--warning-color);
        }

        .hypothesis-card {
            background: rgba(10, 14, 39, 0.4);
            border: 1px solid rgba(0, 240, 255, 0.2);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .hypothesis-card:hover {
            border-color: rgba(0, 240, 255, 0.4);
            background: rgba(10, 14, 39, 0.6);
        }

        .hypothesis-title {
            color: var(--primary-cyan);
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 1.05em;
        }

        .evidence-item {
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid var(--success-color);
            padding: 12px;
            margin: 10px 0;
            font-size: 0.9em;
            border-radius: 6px;
        }

        .bias-warning {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(251, 191, 36, 0.05));
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 10px;
            padding: 16px;
            margin: 12px 0;
        }

        .bias-type {
            color: var(--warning-color);
            font-weight: 600;
        }

        .scenario-choice {
            background: rgba(10, 14, 39, 0.4);
            border: 1px solid rgba(0, 240, 255, 0.2);
            border-radius: 10px;
            padding: 14px;
            margin: 12px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scenario-choice:hover {
            background: rgba(0, 240, 255, 0.1);
            border-color: var(--primary-cyan);
            transform: translateX(4px);
        }

        .loading {
            color: var(--primary-cyan);
            text-align: center;
            padding: 24px;
            font-weight: 500;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .tab-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .tab-button {
            background: rgba(10, 14, 39, 0.4);
            border: 1px solid rgba(0, 240, 255, 0.2);
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .tab-button.active {
            background: linear-gradient(135deg, var(--primary-cyan) 0%, var(--primary-blue) 100%);
            color: var(--darker-bg);
            border-color: transparent;
            box-shadow: 0 4px 16px rgba(0, 240, 255, 0.3);
        }

        .inconsistency {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid var(--danger-color);
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
        }

        .analysis-section {
            margin: 24px 0;
            padding: 20px;
            background: rgba(10, 14, 39, 0.4);
            border-radius: 12px;
            border: 1px solid rgba(0, 240, 255, 0.1);
        }

        .section-title {
            color: var(--primary-cyan);
            font-weight: 600;
            margin-bottom: 14px;
            font-size: 1.1em;
            letter-spacing: 0.5px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 20px 16px;
            }

            h1 {
                font-size: 1.6em;
            }

            .module-grid {
                grid-template-columns: 1fr;
            }

            .workspace {
                padding: 20px;
            }

            .connection-status {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        /* Enhanced Animations */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        .shimmer {
            background: linear-gradient(
                90deg,
                transparent 0%,
                rgba(0, 240, 255, 0.1) 50%,
                transparent 100%
            );
            background-size: 1000px 100%;
            animation: shimmer 3s infinite linear;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><span>üîç</span> FORENSIC REASONING TRAINING SYSTEM</h1>
            <div class="subtitle">LOCAL OFFLINE INVESTIGATIVE ANALYSIS PLATFORM ‚Ä¢ LLaMA 3.2 via Ollama</div>
        </header>

        <div class="warning-banner">
            <strong>‚ö† RESEARCH & TRAINING TOOL ONLY</strong>
            This system is designed for educational purposes to train investigative reasoning skills. It does NOT determine guilt, solve crimes, or replace human judgment. All outputs represent hypotheses and require critical evaluation by trained professionals.
        </div>

        <div class="connection-status">
            <div class="status-info">
                <span class="status-indicator status-disconnected" id="statusIndicator"></span>
                <div class="status-text-group">
                    <span id="statusText">Checking Ollama connection...</span>
                    <p>Ensure Ollama is running with LLaMA 3.2 model for full functionality.</p>
                </div>
            </div>
            <button onclick="checkConnection()">Reconnect</button>
        </div>

        <div class="module-grid">
            <div class="module-card" onclick="activateModule('reconstruction')">
                <div class="module-icon">üìã</div>
                <div class="module-title">Case Reconstruction</div>
                <div class="module-desc">Structure unstructured case data from FIRs, reports, and statements</div>
            </div>

            <div class="module-card" onclick="activateModule('timeline')">
                <div class="module-icon">‚è±Ô∏è</div>
                <div class="module-title">Timeline Builder</div>
                <div class="module-desc">Construct chronological sequences with uncertainty markers</div>
            </div>

            <div class="module-card" onclick="activateModule('hypothesis')">
                <div class="module-icon">üß©</div>
                <div class="module-title">Evidence-Hypothesis Mapping</div>
                <div class="module-desc">Generate and compare multiple competing theories</div>
            </div>

            <div class="module-card" onclick="activateModule('bias')">
                <div class="module-icon">üß†</div>
                <div class="module-title">Cognitive Bias Detection</div>
                <div class="module-desc">Identify confirmation bias, tunnel vision, and hindsight bias</div>
            </div>

            <div class="module-card" onclick="activateModule('witness')">
                <div class="module-icon">üí¨</div>
                <div class="module-title">Witness Statement Analysis</div>
                <div class="module-desc">Detect inconsistencies, ambiguities, and narrative gaps</div>
            </div>

            <div class="module-card" onclick="activateModule('scenario')">
                <div class="module-icon">üé≠</div>
                <div class="module-title">Interactive Scenario Simulator</div>
                <div class="module-desc">Practice investigative decisions in simulated cases</div>
            </div>
        </div>

        <!-- Case Reconstruction Module -->
        <div id="reconstruction" class="workspace">
            <h2><span>üìã</span> Case Reconstruction</h2>
            <div class="input-group">
                <label>Case Materials (FIR, autopsy notes, witness statements, etc.)</label>
                <textarea id="caseInput" placeholder="Paste unstructured case materials here...&#10;&#10;Example:&#10;FIR No. 123/2024&#10;Complainant: John Doe&#10;Incident: Suspicious death&#10;Date: 15 Jan 2024&#10;Location: 123 Main Street&#10;..."></textarea>
            </div>
            <button onclick="reconstructCase()">Analyze & Reconstruct</button>
            <div id="reconstructionOutput" class="output-area"></div>
        </div>

        <!-- Timeline Builder Module -->
        <div id="timeline" class="workspace">
            <h2><span>‚è±Ô∏è</span> Timeline Builder</h2>
            <div class="input-group">
                <label>Events & Temporal Information</label>
                <textarea id="timelineInput" placeholder="Enter events with any available time information...&#10;&#10;Example:&#10;- Victim last seen at 8:30 PM by neighbor&#10;- Witness heard argument around 9 PM (uncertain)&#10;- 911 call received at 9:47 PM&#10;- Body discovered next morning at 7:15 AM"></textarea>
            </div>
            <button onclick="buildTimeline()">Generate Timeline</button>
            <div id="timelineOutput" class="output-area"></div>
        </div>

        <!-- Hypothesis Mapping Module -->
        <div id="hypothesis" class="workspace">
            <h2><span>üß©</span> Evidence-Hypothesis Mapping</h2>
            <div class="input-group">
                <label>Evidence & Observations</label>
                <textarea id="evidenceInput" placeholder="List available evidence and observations...&#10;&#10;Example:&#10;- Broken window in bedroom&#10;- Footprints in garden (size 10, muddy)&#10;- Victim's phone missing&#10;- No signs of forced entry at doors&#10;- Neighbor reports seeing unfamiliar car"></textarea>
            </div>
            <button onclick="mapHypotheses()">Generate Competing Hypotheses</button>
            <div id="hypothesisOutput" class="output-area"></div>
        </div>

        <!-- Bias Detection Module -->
        <div id="bias" class="workspace">
            <h2><span>üß†</span> Cognitive Bias Detection</h2>
            <div class="input-group">
                <label>Investigation Notes & Reasoning</label>
                <textarea id="biasInput" placeholder="Paste investigation notes, preliminary conclusions, or reasoning to analyze for potential biases...&#10;&#10;Example:&#10;The suspect has a criminal record, which strongly suggests involvement. The broken window clearly indicates forced entry. Given the suspect's history, we should focus our investigation on their whereabouts."></textarea>
            </div>
            <button onclick="detectBias()">Analyze for Cognitive Biases</button>
            <div id="biasOutput" class="output-area"></div>
        </div>

        <!-- Witness Analysis Module -->
        <div id="witness" class="workspace">
            <h2><span>üí¨</span> Witness Statement Analysis</h2>
            <div class="input-group">
                <label>Witness Statement(s)</label>
                <textarea id="witnessInput" placeholder="Enter one or more witness statements...&#10;&#10;Example:&#10;Witness A: I saw the victim around 8 PM. He was alone and seemed normal.&#10;&#10;Witness B: I heard shouting at about 9:30 PM. It sounded like two people arguing.&#10;&#10;Witness A (follow-up): Actually, now that I think about it, there was someone with him. I'm not sure of the time though."></textarea>
            </div>
            <button onclick="analyzeWitness()">Analyze Statements</button>
            <div id="witnessOutput" class="output-area"></div>
        </div>

        <!-- Scenario Simulator Module -->
        <div id="scenario" class="workspace">
            <h2><span>üé≠</span> Interactive Scenario Simulator</h2>
            <button onclick="startScenario()">Start New Scenario</button>
            <button onclick="resetScenario()">Reset Scenario</button>
            <div id="scenarioOutput" class="output-area"></div>
        </div>
    </div>

    <script>
        let ollamaConnected = false;
        let currentModule = null;
        let scenarioState = {
            stage: 0,
            evidence: [],
            decisions: []
        };

        // Check Ollama connection
        async function checkConnection() {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            try {
                const response = await fetch('http://localhost:11434/api/tags');
                if (response.ok) {
                    ollamaConnected = true;
                    statusIndicator.className = 'status-indicator status-connected';
                    statusText.textContent = 'Connected to Ollama (LLaMA 3.2 ready)';
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                ollamaConnected = false;
                statusIndicator.className = 'status-indicator status-disconnected';
                statusText.textContent = 'Ollama not connected. Please ensure Ollama is running with LLaMA 3.2 model.';
            }
        }

        // Call Ollama API
        async function callOllama(prompt, systemPrompt) {
            if (!ollamaConnected) {
                return "Error: Ollama is not connected. Please start Ollama and ensure LLaMA 3.2 is available.";
            }

            try {
                const response = await fetch('http://localhost:11434/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'llama3.2',
                        prompt: prompt,
                        system: systemPrompt,
                        stream: false
                    })
                });

                const data = await response.json();
                return data.response;
            } catch (error) {
                return `Error communicating with Ollama: ${error.message}`;
            }
        }

        // Module activation
        function activateModule(moduleName) {
            // Deactivate all modules
            document.querySelectorAll('.workspace').forEach(w => w.classList.remove('active'));
            document.querySelectorAll('.module-card').forEach(c => c.classList.remove('active'));
            
            // Activate selected module
            document.getElementById(moduleName).classList.add('active');
            event.currentTarget.classList.add('active');
            currentModule = moduleName;
        }

        // Case Reconstruction
        async function reconstructCase() {
            const input = document.getElementById('caseInput').value;
            const output = document.getElementById('reconstructionOutput');
            
            if (!input.trim()) {
                output.innerHTML = '<div class="bias-warning">Please enter case materials to analyze.</div>';
                return;
            }

            output.innerHTML = '<div class="loading">Analyzing case materials</div>';

            const systemPrompt = `You are a forensic analysis training assistant. Your role is to help structure unstructured case information for educational purposes. 

CRITICAL RULES:
1. Never claim to solve the case or determine guilt
2. Always present multiple possibilities
3. Clearly mark uncertainties and gaps in information
4. Focus on teaching investigative methodology
5. Remind users that this is for training purposes only

Analyze the provided case materials and provide:
1. Key parties involved (victims, witnesses, suspects - noting that "suspect" is a preliminary investigative category)
2. Critical timeline elements
3. Physical evidence mentioned
4. Information gaps that need investigation
5. Potential lines of inquiry (multiple possibilities)

Format your response clearly with sections.`;

            const prompt = `Analyze this case material and structure it for investigative training purposes:\n\n${input}`;

            const result = await callOllama(prompt, systemPrompt);
            
            output.innerHTML = `
                <div class="analysis-section">
                    <div class="section-title">STRUCTURED ANALYSIS</div>
                    <div style="white-space: pre-wrap;">${result}</div>
                </div>
                <div class="bias-warning">
                    <strong>Training Note:</strong> This analysis is for educational purposes. All conclusions are preliminary hypotheses that require verification through proper investigative procedures.
                </div>
            `;
        }

        // Timeline Builder
        async function buildTimeline() {
            const input = document.getElementById('timelineInput').value;
            const output = document.getElementById('timelineOutput');
            
            if (!input.trim()) {
                output.innerHTML = '<div class="bias-warning">Please enter temporal information to build a timeline.</div>';
                return;
            }

            output.innerHTML = '<div class="loading">Constructing timeline</div>';

            const systemPrompt = `You are a forensic timeline analysis training tool. Create chronological timelines from provided information while:

1. Clearly marking CERTAIN vs UNCERTAIN time points
2. Identifying gaps in the timeline
3. Noting conflicting temporal information
4. Distinguishing between precise times and approximations
5. Highlighting what additional temporal evidence would be valuable

Use uncertainty markers like:
- [CONFIRMED] for verified times
- [APPROXIMATE] for estimated times
- [UNCERTAIN] for unclear temporal information
- [CONFLICT] for contradictory timing
- [GAP] for missing time periods

Present the timeline chronologically and note all assumptions.`;

            const prompt = `Create an investigative timeline from this information:\n\n${input}`;

            const result = await callOllama(prompt, systemPrompt);
            
            output.innerHTML = `
                <div class="analysis-section">
                    <div class="section-title">TEMPORAL ANALYSIS</div>
                    <div style="white-space: pre-wrap;">${result}</div>
                </div>
                <div class="uncertainty">
                    ‚ö† Timeline represents current information state. Uncertainty markers indicate areas requiring additional investigation.
                </div>
            `;
        }

        // Hypothesis Mapping
        async function mapHypotheses() {
            const input = document.getElementById('evidenceInput').value;
            const output = document.getElementById('hypothesisOutput');
            
            if (!input.trim()) {
                output.innerHTML = '<div class="bias-warning">Please enter evidence to generate hypotheses.</div>';
                return;
            }

            output.innerHTML = '<div class="loading">Generating competing hypotheses</div>';

            const systemPrompt = `You are a forensic reasoning training assistant specializing in hypothesis generation. Generate MULTIPLE competing hypotheses that could explain the evidence.

CRITICAL REQUIREMENTS:
1. Generate at least 3-5 different hypotheses
2. DO NOT favor one hypothesis over others
3. For each hypothesis, list: supporting evidence, contradicting evidence, and gaps
4. Include both common and alternative explanations
5. Clearly state what additional evidence would support or refute each hypothesis
6. Emphasize that all are working theories requiring investigation

This teaches investigators to avoid tunnel vision and consider multiple possibilities.`;

            const prompt = `Based on this evidence, generate multiple competing hypotheses:\n\n${input}`;

            const result = await callOllama(prompt, systemPrompt);
            
            output.innerHTML = `
                <div class="analysis-section">
                    <div class="section-title">COMPETING HYPOTHESES</div>
                    <div style="white-space: pre-wrap;">${result}</div>
                </div>
                <div class="bias-warning">
                    <strong>Investigation Principle:</strong> Maintain all viable hypotheses until evidence conclusively eliminates them. Avoid premature commitment to a single theory.
                </div>
            `;
        }

        // Bias Detection
        async function detectBias() {
            const input = document.getElementById('biasInput').value;
            const output = document.getElementById('biasOutput');
            
            if (!input.trim()) {
                output.innerHTML = '<div class="bias-warning">Please enter investigation notes to analyze for biases.</div>';
                return;
            }

            output.innerHTML = '<div class="loading">Analyzing for cognitive biases</div>';

            const systemPrompt = `You are a forensic psychology training tool focused on identifying cognitive biases in investigations. Analyze the provided text for:

1. CONFIRMATION BIAS: Seeking only evidence that supports initial theory
2. TUNNEL VISION: Focusing on one suspect/theory while ignoring alternatives
3. HINDSIGHT BIAS: Believing outcome was predictable after knowing the result
4. ANCHORING BIAS: Over-relying on initial information
5. AVAILABILITY BIAS: Overweighting easily recalled information

For each bias detected:
- Explain what language/reasoning indicates the bias
- Suggest how to mitigate it
- Propose alternative approaches
- Note: this is educational feedback, not a definitive diagnosis

Be constructive and educational in tone.`;

            const prompt = `Analyze this investigation reasoning for potential cognitive biases:\n\n${input}`;

            const result = await callOllama(prompt, systemPrompt);
            
            output.innerHTML = `
                <div class="analysis-section">
                    <div class="section-title">COGNITIVE BIAS ANALYSIS</div>
                    <div style="white-space: pre-wrap;">${result}</div>
                </div>
                <div class="uncertainty">
                    üí° This analysis helps identify potential reasoning pitfalls. Use it to reflect on investigative approach, not as definitive bias confirmation.
                </div>
            `;
        }

        // Witness Statement Analysis
        async function analyzeWitness() {
            const input = document.getElementById('witnessInput').value;
            const output = document.getElementById('witnessOutput');
            
            if (!input.trim()) {
                output.innerHTML = '<div class="bias-warning">Please enter witness statement(s) to analyze.</div>';
                return;
            }

            output.innerHTML = '<div class="loading">Analyzing witness statements</div>';

            const systemPrompt = `You are a forensic statement analysis training tool. Analyze witness statements for:

1. INCONSISTENCIES: Internal contradictions or changes across statements
2. AMBIGUITIES: Vague language or unclear references
3. NARRATIVE GAPS: Missing information or unexplained jumps
4. TEMPORAL ISSUES: Timeline problems or unclear sequences
5. SPECIFICITY PATTERNS: Areas of high vs low detail

CRITICAL: You are NOT doing lie detection. Focus on:
- What information is present vs absent
- Where clarification is needed
- What follow-up questions would help
- Potential memory or perception issues

Never conclude someone is lying. Focus on information quality and investigative needs.`;

            const prompt = `Analyze these witness statements for ambiguities, inconsistencies, and gaps:\n\n${input}`;

            const result = await callOllama(prompt, systemPrompt);
            
            output.innerHTML = `
                <div class="analysis-section">
                    <div class="section-title">STATEMENT ANALYSIS</div>
                    <div style="white-space: pre-wrap;">${result}</div>
                </div>
                <div class="bias-warning">
                    <strong>Important:</strong> This analysis identifies areas needing clarification, NOT deception. Inconsistencies may result from memory issues, perception differences, or communication problems.
                </div>
            `;
        }

        // Interactive Scenario
        async function startScenario() {
            const output = document.getElementById('scenarioOutput');
            output.innerHTML = '<div class="loading">Generating scenario</div>';

            const systemPrompt = `You are an interactive forensic training scenario generator. Create a realistic but fictional crime scenario for training purposes.

Generate:
1. Initial scenario description (brief, ambiguous)
2. 3-4 initial investigative action choices
3. Note what evidence might be available for each choice

Keep it educational and realistic. The scenario should have multiple valid investigation paths.`;

            const prompt = 'Generate a new forensic training scenario with initial investigative choices.';

            const result = await callOllama(prompt, systemPrompt);
            
            scenarioState.stage = 1;
            scenarioState.evidence = [];
            scenarioState.decisions = [];
            
            output.innerHTML = `
                <div class="analysis-section">
                    <div class="section-title">SCENARIO: INITIAL BRIEFING</div>
                    <div style="white-space: pre-wrap; margin-bottom: 20px;">${result}</div>
                    <div class="input-group">
                        <label>Your Investigative Decision:</label>
                        <textarea id="scenarioChoice" placeholder="Describe your chosen investigative action and reasoning..."></textarea>
                    </div>
                    <button onclick="makeScenarioChoice()">Submit Decision</button>
                </div>
            `;
        }

        async function makeScenarioChoice() {
            const choice = document.getElementById('scenarioChoice').value;
            const output = document.getElementById('scenarioOutput');
            
            if (!choice.trim()) {
                return;
            }

            output.innerHTML = '<div class="loading">Processing decision and revealing evidence</div>';

            scenarioState.decisions.push(choice);
            scenarioState.stage++;

            const systemPrompt = `You are continuing an interactive forensic training scenario. Based on the investigator's choice, reveal new evidence and present new decision points.

Rules:
1. Evidence revealed should be logical based on their choice
2. Include some unexpected elements to teach adaptability
3. Maintain ambiguity - don't make solutions obvious
4. Present new investigative choices
5. Occasionally introduce complications or dilemmas

Keep responses focused and educational.`;

            const prompt = `Previous scenario state: ${JSON.stringify(scenarioState)}

Investigator's decision: ${choice}

Provide: 
1. New evidence uncovered
2. New investigative challenges or questions
3. Next decision points`;

            const result = await callOllama(prompt, systemPrompt);
            
            output.innerHTML = `
                <div class="analysis-section">
                    <div class="section-title">SCENARIO UPDATE: STAGE ${scenarioState.stage}</div>
                    <div style="white-space: pre-wrap; margin-bottom: 20px;">${result}</div>
                    <div class="input-group">
                        <label>Next Action:</label>
                        <textarea id="scenarioChoice" placeholder="Describe your next investigative move..."></textarea>
                    </div>
                    <button onclick="makeScenarioChoice()">Submit Decision</button>
                </div>
            `;
        }

        // Reset Scenario
        function resetScenario() {
            scenarioState = {
                stage: 0,
                evidence: [],
                decisions: []
            };
            document.getElementById('scenarioOutput').innerHTML = '';
            startScenario();
        }

        // Initialize
        window.onload = function() {
            checkConnection();
            
            // Periodically check connection
            setInterval(checkConnection, 30000);
        };

    </script>
</body>
</html>